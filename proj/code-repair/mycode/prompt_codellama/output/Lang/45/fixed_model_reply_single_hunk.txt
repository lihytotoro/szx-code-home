if (upper == -1 || upper > str.length()) {
    upper = str.length();
}
